{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://eleanor.ai/schemas/evidence-bundle.json",
  "title": "EvidenceBundle",
  "description": "Atomic reasoning unit generated by a single critic with full context, justification, and metadata for aggregation.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "bundle_id",
    "metadata",
    "input_snapshot",
    "critic_output",
    "justification"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Semantic version of the evidence bundle schema applied when generating this bundle.",
      "pattern": "^v?\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0", "v1.0.0"]
    },
    "bundle_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this evidence bundle instance.",
      "examples": ["1b4e28ba-2fa1-11d2-883f-0016d3cca427"]
    },
        "metadata": {
          "type": "object",
          "additionalProperties": false,
          "description": "Provenance data describing when and how the critic produced this bundle.",
      "required": [
        "critic",
        "timestamp",
        "config_version"
      ],
          "properties": {
            "critic": {
              "type": "object",
              "additionalProperties": false,
              "description": "Critic identity and classification.",
          "required": [
            "name",
            "version"
          ],
              "properties": {
                "name": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Human-readable critic name (e.g., SafetyCritic)."
                },
                "version": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Implementation or prompt version for the critic logic."
                },
            "priority": {
              "type": "string",
              "description": "Operational priority level used by the orchestrator.",
              "enum": ["low", "medium", "high", "critical"]
            },
            "category": {
              "type": "string",
              "description": "Classification of the critic (e.g., safety, compliance, policy)."
            }
          }
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp when the critic emitted the bundle.",
          "examples": ["2024-05-12T14:03:00Z"]
        },
        "config_version": {
          "type": "string",
          "minLength": 1,
          "description": "Version hash or tag of the critic configuration applied to this run.",
          "examples": ["config-v2.3.1"]
        },
        "run_id": {
          "type": "string",
          "minLength": 1,
          "description": "Execution identifier tying the bundle to a specific pipeline run."
        },
        "latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "End-to-end critic evaluation time in milliseconds."
        },
        "environment": {
          "type": "object",
          "additionalProperties": false,
          "description": "System environment details used for reproducibility.",
          "properties": {
            "runtime": {
              "type": "string",
              "minLength": 1,
              "description": "Runtime or container image identifier."
            },
            "model": {
              "type": "string",
              "minLength": 1,
              "description": "Model or ruleset version used by the critic."
            },
            "geography": {
              "type": "string",
              "minLength": 1,
              "description": "Physical or logical region of execution."
            }
          }
        }
      }
    },
    "input_snapshot": {
      "type": "object",
      "additionalProperties": false,
      "description": "Immutable view of the user input and context at the time of evaluation.",
      "required": [
        "prompt"
      ],
      "properties": {
        "prompt": {
          "type": "string",
          "minLength": 1,
          "description": "Raw prompt or request text supplied to the critic."
        },
        "context": {
          "type": "object",
          "description": "Structured context provided to the critic (variables, metadata, constraints).",
          "additionalProperties": true
        },
        "precedent_ids": {
          "type": "array",
          "description": "Identifiers of precedents surfaced to the critic.",
          "items": {
            "type": "string",
            "format": "uuid"
          }
        },
        "attachments": {
          "type": "array",
          "description": "Supplementary artifacts provided to the critic.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "type",
              "uri"
            ],
            "properties": {
              "type": {
                "type": "string",
                "minLength": 1,
                "description": "Attachment classification (e.g., pdf, screenshot, transcript)."
              },
              "uri": {
                "type": "string",
                "format": "uri",
                "minLength": 1,
                "description": "Location of the attachment."
              },
              "checksum": {
                "type": "string",
                "minLength": 1,
                "description": "Integrity hash for the attachment content."
              }
            }
          }
        }
      }
    },
    "critic_output": {
      "type": "object",
      "additionalProperties": false,
      "description": "Normalized critic assessment derived from the input snapshot.",
      "required": [
        "verdict",
        "confidence",
        "findings"
      ],
      "properties": {
        "verdict": {
          "type": "string",
          "description": "Critic decision for the evaluated input.",
          "enum": ["ALLOW", "DENY", "REVIEW", "BLOCK"]
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Normalized confidence score for the verdict."
        },
        "severity": {
          "type": "string",
          "description": "Highest severity among the findings.",
          "enum": ["info", "low", "moderate", "high", "critical"]
        },
        "findings": {
          "type": "array",
          "minItems": 1,
          "description": "Individual findings that support the verdict.",
          "items": {
            "$ref": "#/definitions/Finding"
          }
        },
        "recommended_actions": {
          "type": "array",
          "description": "Remediation or escalation steps proposed by the critic.",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "labels": {
          "type": "array",
          "description": "Tags applied by the critic for downstream routing.",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "justification": {
      "type": "object",
      "additionalProperties": false,
      "description": "Structured rationale and supporting evidence for the critic decision.",
      "required": [
        "summary",
        "supporting_evidence"
      ],
      "properties": {
        "summary": {
          "type": "string",
          "minLength": 20,
          "description": "Primary explanation tying findings to the verdict."
        },
        "supporting_evidence": {
          "type": "array",
          "minItems": 1,
          "description": "Evidence citations or quotations that underpin the summary.",
          "items": {
            "$ref": "#/definitions/EvidenceItem"
          }
        },
        "reasoning_trace": {
          "type": "array",
          "description": "Step-by-step reasoning chain used by the critic.",
          "items": {
            "$ref": "#/definitions/ReasoningStep"
          }
        },
        "uncertainties": {
          "type": "array",
          "description": "Known uncertainties or caveats noted by the critic.",
          "items": {
            "type": "string"
          }
        }
      }
    }
  },
  "definitions": {
    "Finding": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "code",
        "description",
        "evidence",
        "confidence"
      ],
      "properties": {
        "code": {
          "type": "string",
          "minLength": 1,
          "description": "Stable identifier for the type of finding (e.g., SAFETY_PHYSICAL_HARM)."
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Human-readable explanation of the detected issue or compliance result."
        },
        "severity": {
          "type": "string",
          "enum": ["info", "low", "moderate", "high", "critical"],
          "description": "Severity level for this finding."
        },
        "evidence": {
          "type": "array",
          "description": "Specific snippets or facts supporting the finding.",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/EvidenceItem"
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Confidence score for this finding."
        }
      }
    },
    "EvidenceItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "content"
      ],
      "properties": {
        "type": {
          "type": "string",
          "minLength": 1,
          "description": "Kind of evidence (quote, rule_reference, precedent, calculation)."
        },
        "content": {
          "type": "string",
          "minLength": 1,
          "description": "Text of the evidence or citation reference."
        },
        "source": {
          "type": "string",
          "minLength": 1,
          "enum": ["input", "knowledge_base", "policy", "precedent_id", "system"],
          "description": "Origin of the evidence (input, knowledge_base, policy, precedent_id)."
        },
        "span": {
          "type": "object",
          "additionalProperties": false,
          "description": "Optional character offsets for quoted evidence.",
          "properties": {
            "start": {"type": "integer", "minimum": 0},
            "end": {"type": "integer", "minimum": 0}
          }
        }
      }
    },
    "ReasoningStep": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "description"
      ],
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Narrative for a single reasoning step."
        },
        "linked_findings": {
          "type": "array",
          "description": "Finding codes that this reasoning step depends on.",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Confidence in the reasoning step."
        }
      }
    }
  }
}
